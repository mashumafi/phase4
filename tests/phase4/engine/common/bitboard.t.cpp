#include <phase4/engine/common/bitboard.h>

#include <doctest/doctest.h>

#include <sstream>

TEST_CASE("Bitboard getLsb") {
	using namespace phase4::engine::common;

	CHECK(Bitboard(0b00101).getLsb() == Bitboard(0b001));
	CHECK(Bitboard(0b10100).getLsb() == 0b100);
	CHECK(Bitboard(0b10100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).getLsb() == 0b00100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000);
}

TEST_CASE("Bitboard popLsb") {
	using namespace phase4::engine::common;

	CHECK(Bitboard(0b00101).popLsb() == Bitboard(0b00100));
	CHECK(Bitboard(0b10100).popLsb() == 0b10000);

	CHECK(Bitboard(0b10100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).popLsb() == 0b10000000'00000000'00000000'00000000'00000000'00000000'00000000'00000000);
	CHECK(Bitboard(0b00000101'00000000'00000000'00000000'00000000'00000000'00000000'00000000).popLsb() == 0b00000100'00000000'00000000'00000000'00000000'00000000'00000000'00000000);
}

TEST_CASE("Bitboard count") {
	using namespace phase4::engine::common;

	CHECK(Bitboard(0b00101).fastCount() == 2);
	CHECK(Bitboard(0b10100).fastCount() == 2);
	CHECK(Bitboard(0b10100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).fastCount() == 2);

	CHECK(Bitboard(0b00101).count() == 2);
	CHECK(Bitboard(0b10100).count() == 2);
	CHECK(Bitboard(0b10100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).count() == 2);
}

TEST_CASE("Bitboard bitScan") {
	using namespace phase4::engine::common;

	CHECK(Bitboard(0b00101).fastBitScan() == 0);
	CHECK(Bitboard((0b10100)).fastBitScan() == 2);
	CHECK(Bitboard(0b10100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).fastBitScan() == 61);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).fastBitScan() == 63);
	CHECK(Bitboard(0b10000001'00000000'00000000'00000000'00000000'00000000'00000000'00000000).fastBitScan() == 56);

	CHECK(Bitboard(0b00101).bitScan() == 0);
	CHECK(Bitboard((0b10100)).bitScan() == 2);
	CHECK(Bitboard(0b10100000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).bitScan() == 61);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000'00000000'00000000'00000000'00000000).bitScan() == 63);
	CHECK(Bitboard(0b10000001'00000000'00000000'00000000'00000000'00000000'00000000'00000000).bitScan() == 56);
}

TEST_CASE("Bitboard output") {
	using namespace phase4::engine::common;

	Bitboard bs = 0b1000000000000100000100000001000000000000000000000000000000000101;
	std::stringstream ss;
	ss << bs;
	CHECK(ss.str() == "1000000000000100000100000001000000000000000000000000000000000101");
}

TEST_CASE("Bitboard equality") {
	using namespace phase4::engine::common;

	CHECK(Bitboard(0b0) == 0);
	CHECK(Bitboard(0b0000) == 0);
	CHECK(Bitboard(0b00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000'00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000'00000000'00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000'00000000'00000000'00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000'00000000'00000000'00000000'00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000'00000000'00000000'00000000'00000000'00000000) == 0);
	CHECK(Bitboard(0b00000000'00000000'00000000'00000000'00000000'00000000'00000000'00000000) == 0);

	CHECK(Bitboard(0b1) != 0);
	CHECK(Bitboard(0b1000) != 0);
	CHECK(Bitboard(0b10000000) != 0);
	CHECK(Bitboard(0b10000000'00000000) != 0);
	CHECK(Bitboard(0b10000000'00000000'00000000) != 0);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000) != 0);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000'00000000) != 0);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000'00000000'00000000) != 0);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000'00000000'00000000'00000000) != 0);
	CHECK(Bitboard(0b10000000'00000000'00000000'00000000'00000000'00000000'00000000'00000000) != 0);
}